# Directory Extension Development Guide

Generated by `elfiee-ext-gen`

---

## Overview

This extension provides the following capabilities:

- **list**: TODO: Describe what this capability does

- **create**: TODO: Describe what this capability does

- **delete**: TODO: Describe what this capability does

- **rename**: TODO: Describe what this capability does

- **refresh**: TODO: Describe what this capability does

- **watch**: TODO: Describe what this capability does

- **search**: TODO: Describe what this capability does


---

## Development Workflow

### 1. Define Payload Structure

Edit `mod.rs` - Replace the generic `serde_json::Value` with specific fields:


#### DirectoryListPayload

Suggested fields:
```rust
#[derive(Debug, Clone, Serialize, Deserialize, Type)]
pub struct DirectoryListPayload {
    
    /// Generic data field - replace with specific fields
    pub data: serde_json::Value,
    
}
```

#### DirectoryCreatePayload

Suggested fields:
```rust
#[derive(Debug, Clone, Serialize, Deserialize, Type)]
pub struct DirectoryCreatePayload {
    
    /// The text content to add
    pub text: String,
    
    /// Optional priority level
    pub priority: Option<u32>,
    
}
```

#### DirectoryDeletePayload

Suggested fields:
```rust
#[derive(Debug, Clone, Serialize, Deserialize, Type)]
pub struct DirectoryDeletePayload {
    
    /// Generic data field - replace with specific fields
    pub data: serde_json::Value,
    
}
```

#### DirectoryRenamePayload

Suggested fields:
```rust
#[derive(Debug, Clone, Serialize, Deserialize, Type)]
pub struct DirectoryRenamePayload {
    
    /// Generic data field - replace with specific fields
    pub data: serde_json::Value,
    
}
```

#### DirectoryRefreshPayload

Suggested fields:
```rust
#[derive(Debug, Clone, Serialize, Deserialize, Type)]
pub struct DirectoryRefreshPayload {
    
    /// Generic data field - replace with specific fields
    pub data: serde_json::Value,
    
}
```

#### DirectoryWatchPayload

Suggested fields:
```rust
#[derive(Debug, Clone, Serialize, Deserialize, Type)]
pub struct DirectoryWatchPayload {
    
    /// Generic data field - replace with specific fields
    pub data: serde_json::Value,
    
}
```

#### DirectorySearchPayload

Suggested fields:
```rust
#[derive(Debug, Clone, Serialize, Deserialize, Type)]
pub struct DirectorySearchPayload {
    
    /// Generic data field - replace with specific fields
    pub data: serde_json::Value,
    
}
```


**Action Items**:
- [ ] Define all required fields with appropriate types
- [ ] Add documentation for each field
- [ ] Remove the generic `data: serde_json::Value` field

---

### 2. Implement Handler Logic


#### File: `directory_list.rs`

Replace the `todo!()` markers with actual implementation:

```rust
#[capability(id = "directory.list", target = "directory")]
pub fn handle_list(cmd: &Command, block: Option<&Block>) -> CapResult<Vec<Event>> {
    // 1. Deserialize payload
    let payload: DirectoryListPayload = serde_json::from_value(cmd.payload.clone())
        .map_err(|e| format!("Failed to deserialize payload: {}", e))?;

    // 2. Validate input
    // ... your validation logic ...

    // 3. Perform operation
    // ... your business logic ...

    // 4. Create events
    Ok(vec![Event {
        // ... event fields ...
    }])
}
```

#### File: `directory_create.rs`

Replace the `todo!()` markers with actual implementation:

```rust
#[capability(id = "directory.create", target = "directory")]
pub fn handle_create(cmd: &Command, block: Option<&Block>) -> CapResult<Vec<Event>> {
    // 1. Deserialize payload
    let payload: DirectoryCreatePayload = serde_json::from_value(cmd.payload.clone())
        .map_err(|e| format!("Failed to deserialize payload: {}", e))?;

    // 2. Validate input
    // ... your validation logic ...

    // 3. Perform operation
    // ... your business logic ...

    // 4. Create events
    Ok(vec![Event {
        // ... event fields ...
    }])
}
```

#### File: `directory_delete.rs`

Replace the `todo!()` markers with actual implementation:

```rust
#[capability(id = "directory.delete", target = "directory")]
pub fn handle_delete(cmd: &Command, block: Option<&Block>) -> CapResult<Vec<Event>> {
    // 1. Deserialize payload
    let payload: DirectoryDeletePayload = serde_json::from_value(cmd.payload.clone())
        .map_err(|e| format!("Failed to deserialize payload: {}", e))?;

    // 2. Validate input
    // ... your validation logic ...

    // 3. Perform operation
    // ... your business logic ...

    // 4. Create events
    Ok(vec![Event {
        // ... event fields ...
    }])
}
```

#### File: `directory_rename.rs`

Replace the `todo!()` markers with actual implementation:

```rust
#[capability(id = "directory.rename", target = "directory")]
pub fn handle_rename(cmd: &Command, block: Option<&Block>) -> CapResult<Vec<Event>> {
    // 1. Deserialize payload
    let payload: DirectoryRenamePayload = serde_json::from_value(cmd.payload.clone())
        .map_err(|e| format!("Failed to deserialize payload: {}", e))?;

    // 2. Validate input
    // ... your validation logic ...

    // 3. Perform operation
    // ... your business logic ...

    // 4. Create events
    Ok(vec![Event {
        // ... event fields ...
    }])
}
```

#### File: `directory_refresh.rs`

Replace the `todo!()` markers with actual implementation:

```rust
#[capability(id = "directory.refresh", target = "directory")]
pub fn handle_refresh(cmd: &Command, block: Option<&Block>) -> CapResult<Vec<Event>> {
    // 1. Deserialize payload
    let payload: DirectoryRefreshPayload = serde_json::from_value(cmd.payload.clone())
        .map_err(|e| format!("Failed to deserialize payload: {}", e))?;

    // 2. Validate input
    // ... your validation logic ...

    // 3. Perform operation
    // ... your business logic ...

    // 4. Create events
    Ok(vec![Event {
        // ... event fields ...
    }])
}
```

#### File: `directory_watch.rs`

Replace the `todo!()` markers with actual implementation:

```rust
#[capability(id = "directory.watch", target = "directory")]
pub fn handle_watch(cmd: &Command, block: Option<&Block>) -> CapResult<Vec<Event>> {
    // 1. Deserialize payload
    let payload: DirectoryWatchPayload = serde_json::from_value(cmd.payload.clone())
        .map_err(|e| format!("Failed to deserialize payload: {}", e))?;

    // 2. Validate input
    // ... your validation logic ...

    // 3. Perform operation
    // ... your business logic ...

    // 4. Create events
    Ok(vec![Event {
        // ... event fields ...
    }])
}
```

#### File: `directory_search.rs`

Replace the `todo!()` markers with actual implementation:

```rust
#[capability(id = "directory.search", target = "directory")]
pub fn handle_search(cmd: &Command, block: Option<&Block>) -> CapResult<Vec<Event>> {
    // 1. Deserialize payload
    let payload: DirectorySearchPayload = serde_json::from_value(cmd.payload.clone())
        .map_err(|e| format!("Failed to deserialize payload: {}", e))?;

    // 2. Validate input
    // ... your validation logic ...

    // 3. Perform operation
    // ... your business logic ...

    // 4. Create events
    Ok(vec![Event {
        // ... event fields ...
    }])
}
```


---

### 3. Run Tests

```bash
cargo test directory::tests
```

**Expected progression**:
1. All tests fail initially (expected)
2. After defining payloads: some tests pass
3. After implementing handlers: more tests pass
4. After full implementation: all tests pass âœ…

---

## Testing Checklist

- [ ] All payload fields are properly defined
- [ ] All handlers are implemented (no `todo!()` remaining)
- [ ] All tests pass (`cargo test`)
- [ ] Code is documented
- [ ] Edge cases are handled

---

## Next Steps

1. Run initial tests: `cargo test directory::tests`
2. Follow the failing tests to implement features incrementally
3. Use `elfiee-ext-gen guide directory` to track progress

Good luck! ðŸš€
