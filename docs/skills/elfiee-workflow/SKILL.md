---
name: elfiee-workflow
description: "[Workspace-level] Elfiee development rules, coding standards, and project interfaces."
---

# Elfiee Development Workflow

> **Scope**: This is a **workspace-level** skill for developing Elfiee itself.
> For using `.elf` files via HTTP API, see `elfiee-dev/SKILL.md`.

---

## Frontend Interface

### Correct Usage
| Task | Use | NOT |
|------|-----|-----|
| Import API | `import { commands } from '@/bindings'` | `import { invoke } from '@tauri-apps/api'` |
| Import types | `import { Command, Block } from '@/bindings'` | `interface Command { ... }` (manual) |
| Call API | `commands.getBlock(fileId, blockId)` | `invoke('get_block', { ... })` |

### Auto-generated Files (NEVER edit)
| File | Why |
|------|-----|
| `src/bindings.ts` | Generated by tauri-specta, will be overwritten |

---

## Backend Interface

### Adding Capability

| Step | Location | Action |
|------|----------|--------|
| 1 | `src-tauri/src/extensions/{ext}/{cap}.rs` | Create handler with `#[capability]` macro |
| 2 | `src-tauri/src/extensions/{ext}/mod.rs` | Define payload with `#[derive(Serialize, Deserialize, Type)]` |
| 3 | `src-tauri/src/capabilities/registry.rs` | Register: `self.register(Arc::new(CapabilityName))` |

### Adding Tauri Command

| Step | Location | Action |
|------|----------|--------|
| 1 | `src-tauri/src/commands/*.rs` | Add `#[tauri::command]` + `#[specta::specta]` |
| 2 | `src-tauri/src/lib.rs` | Register in debug + release handlers |
| 3 | Terminal | Run `pnpm tauri dev` to regenerate bindings |

---

## Naming Convention

| Rust (snake_case) | TypeScript (camelCase) |
|-------------------|------------------------|
| `get_block` | `getBlock` |
| `init_pty_session` | `initPtySession` |
| `execute_command` | `executeCommand` |

> tauri-specta auto-converts snake_case â†’ camelCase

---

## Development Rules

| Rule | Reason |
|------|--------|
| Use `commands` from `@/bindings` | Type safety |
| Use `executeCommand` for state changes | Event sourcing |
| Define payload in Rust with `Type` derive | Auto-generate TS types |
| Register all commands in `lib.rs` | Bindings generation |

---

## Checklist

### Before Commit
- [ ] `pnpm tauri dev` runs without errors
- [ ] `pnpm tsc --noEmit` passes
- [ ] New capability registered in `registry.rs`
- [ ] New command registered in `lib.rs` (debug + release)
- [ ] Payload has `#[derive(Serialize, Deserialize, Type)]`
