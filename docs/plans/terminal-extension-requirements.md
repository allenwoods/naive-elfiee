# Terminal Extension éœ€æ±‚æ–‡æ¡£

## âœ… éœ€æ±‚å®ŒæˆçŠ¶æ€

**Terminal Extensionå·²å®Œå…¨å®ç°å¹¶æŠ•å…¥ä½¿ç”¨ï¼** 

æœ¬æ–‡æ¡£è®°å½•äº†åŸå§‹éœ€æ±‚å’Œå®é™…å®ç°çš„å¯¹æ¯”ï¼Œä»¥åŠè¶…å‡ºé¢„æœŸçš„åŠŸèƒ½å¢å¼ºã€‚

## åŸå§‹éœ€æ±‚ vs å®é™…å®ç°

### 1. âœ… å‰ç«¯éœ€æ±‚ - å…¨éƒ¨å®ç°ä¸”è¶…å‡ºé¢„æœŸ

- **âœ… Terminal Tab**: å·²å®ç° (`App.tsx` line 21, 71-77)
  - æ ¹æ®blockç±»å‹è‡ªåŠ¨æ˜¾ç¤º/éšè—tab
  - æ™ºèƒ½åˆ‡æ¢é€»è¾‘ (line 28-43)
- **âœ… xterm.jsé›†æˆ**: å®Œæ•´å®ç° (`Terminal.tsx`)
  - å®Œæ•´çš„Terminalä¸»é¢˜å’Œé…ç½®
  - FitAddoné€‚é…çª—å£å¤§å°
- **âœ… å‘½ä»¤æ‰§è¡Œ**: å®Œæ•´çš„å‘½ä»¤å¤„ç†æµç¨‹
  - å®æ—¶å‘½ä»¤æ‰§è¡Œå’Œè¾“å‡ºæ˜¾ç¤º
  - é”™è¯¯å¤„ç†å’ŒçŠ¶æ€åé¦ˆ
- **âœ… å†…å®¹è·å–**: ä½¿ç”¨xterm.js buffer API
  - è·å–å®Œæ•´ç»ˆç«¯ç¼“å†²åŒºå†…å®¹ (line 412-425)
  - æ”¯æŒå†å²å†…å®¹æ¢å¤ (line 194-221)
- **âœ… æŒä¹…åŒ–å­˜å‚¨**: **è¶…å‡ºé¢„æœŸ** - ç›´æ¥é›†æˆEvent Store
  - æ— éœ€ä¸´æ—¶æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡Event Storeç®¡ç†
  - æ›´å¯é çš„æ•°æ®ä¸€è‡´æ€§

### 2. âœ… åç«¯éœ€æ±‚ - å®Œæ•´å®ç°ä¸”æ¶æ„æ›´å…ˆè¿›

- **âœ… Terminal Extension**: å®Œæ•´çš„extension (`src-tauri/src/extensions/terminal/`)
  - ä¸‰ä¸ªcapabilities: `execute`, `write`, `read`
  - å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œæµ‹è¯•è¦†ç›–
- **âœ… å‘½ä»¤æ‰§è¡Œèƒ½åŠ›**: `terminal.execute` capability
  - **æ”¹è¿›å®ç°**: æ™ºèƒ½å‘½ä»¤å¤„ç†ï¼Œcd/pwdç‰¹æ®Šä¼˜åŒ–
  - è·¨å¹³å°æ”¯æŒ (Windows cmd.exe, Unix sh)
  - å®Œæ•´çš„å®‰å…¨éªŒè¯å’Œé”™è¯¯å¤„ç†
- **âœ… çŠ¶æ€ç®¡ç†**: **æ¶æ„å‡çº§** - åŸºäºEvent Store
  - æ— éœ€ä¸´æ—¶æ–‡ä»¶ç®¡ç†
  - äº‹ä»¶æºæ¶æ„ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
  - å®æ—¶çŠ¶æ€åŒæ­¥
- **âœ… ä¿å­˜åŠŸèƒ½**: `terminal.write` capability
  - å³æ—¶ä¿å­˜åˆ°Event Store
  - æ”¯æŒä¼šè¯æ¢å¤å’Œå†å²ç®¡ç†

### 3. âœ… æ•°æ®å­˜å‚¨è®¾è®¡ - æ¶æ„å‡çº§å®Œæˆ

#### åŸå§‹è®¾è®¡ï¼šä¸´æ—¶JSONæ–‡ä»¶
```json
// åŸè®¡åˆ’ï¼šå¤æ‚çš„ä¸´æ—¶æ–‡ä»¶ç®¡ç†
{
  "terminal_session": {
    "file_id": "file-xxx", 
    "command_history": [...]
  }
}
```

#### âœ… å®é™…å®ç°ï¼šEvent Storeæ¶æ„
```json
// å®é™…ï¼šç®€æ´çš„äº‹ä»¶æºæ¶æ„
{
  "entity": "terminal-block-uuid",
  "attribute": "editor-id/terminal.execute",
  "value": {
    "contents": {
      "history": [
        {
          "command": "echo hello",
          "output": "hello", 
          "timestamp": "2025-01-XX...",
          "exit_code": 0
        }
      ],
      "current_directory": ".",
      "saved_content": "ç»ˆç«¯ç¼“å†²åŒºå†…å®¹",
      "saved_at": "2025-01-XX..."
    }
  }
}
```

#### æ¶æ„ä¼˜åŠ¿
- **âœ… æ— ä¸´æ—¶æ–‡ä»¶**: ç›´æ¥é€šè¿‡Event Storeç®¡ç†çŠ¶æ€
- **âœ… å®æ—¶åŒæ­¥**: å‘½ä»¤æ‰§è¡Œåå³æ—¶ä¿å­˜ 
- **âœ… ç‰ˆæœ¬æ§åˆ¶**: Event Storeæä¾›å®Œæ•´å†å²è¿½è¸ª
- **âœ… å¹¶å‘å®‰å…¨**: Actor modelç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### 4. âœ… Block å…³è”éœ€æ±‚ - å…¨éƒ¨å®ç°ä¸”ä¼˜åŒ–

- **âœ… Blocké€‰ä¸­éªŒè¯**: å®Œæ•´å®ç° (`Terminal.tsx` line 469-486)
  - æœªé€‰ä¸­blockæ—¶æ˜¾ç¤ºå‹å¥½æç¤ºä¿¡æ¯
  - åŒ…å«åˆ›å»ºTerminal Blockçš„è¯¦ç»†æŒ‡å¯¼
- **âœ… æ™ºèƒ½ç›®å½•ç®¡ç†**: **è¶…å‡ºé¢„æœŸ** - é«˜çº§è·¯å¾„ç®¡ç† 
  - é»˜è®¤ç›®å½•æ ¹æ®blocké…ç½®è®¾å®š
  - `cd`å‘½ä»¤ç‰¹æ®Šå¤„ç†ï¼Œæ”¯æŒç›¸å¯¹/ç»å¯¹è·¯å¾„
  - å®‰å…¨è·¯å¾„éªŒè¯ï¼Œé˜²æ­¢ç›®å½•éå†æ”»å‡»
- **âœ… ç›®å½•çŠ¶æ€æŒä¹…åŒ–**: å®æ—¶ä¿å­˜å’Œæ¢å¤å½“å‰å·¥ä½œç›®å½•

### 5. âœ… xterm.js å†…å®¹è·å– - å·²å®Œæ•´å®ç°

æ‰€æœ‰å»ºè®®çš„xterm.jså†…å®¹è·å–æ–¹å¼éƒ½å·²åœ¨å®é™…ä»£ç ä¸­å®ç°ï¼š

#### âœ… å·²å®ç°ï¼šè·å–ç¼“å†²åŒºå†…å®¹  
**å®ç°ä½ç½®**: `Terminal.tsx` line 412-425 (`saveTerminalContent`å‡½æ•°)
```typescript
// å®é™…å®ç°ä»£ç ç‰‡æ®µ
const buffer = term.buffer.active
const terminalLines: string[] = []
for (let i = 0; i < buffer.length; i++) {
  const line = buffer.getLine(i)
  if (line) {
    terminalLines.push(line.translateToString(true))
  }
}
const terminalContent = terminalLines.join('\n')
```

#### âœ… å·²å®ç°ï¼šä¼šè¯å†å²ç®¡ç†
**å®ç°ä½ç½®**: `Terminal.tsx` line 194-221 (ä¼šè¯æ¢å¤é€»è¾‘)
- è‡ªåŠ¨æ¢å¤ä¿å­˜çš„terminalå†…å®¹
- æ˜¾ç¤ºä¿å­˜æ—¶é—´å’Œå†…å®¹ç»Ÿè®¡
- ä¼˜é›…çš„ä¼šè¯åˆ†éš”æ˜¾ç¤º

#### âœ… å·²å®ç°ï¼šå®æ—¶æ•°æ®å¤„ç†
**å®ç°ä½ç½®**: `Terminal.tsx` line 315-361 (`onData`äº‹ä»¶å¤„ç†)
- å®Œæ•´çš„é”®ç›˜è¾“å…¥å¤„ç†
- Backspaceã€Enterã€Ctrl+Cç­‰ç‰¹æ®Šé”®å¤„ç†
- å®æ—¶å‘½ä»¤ç¼“å†²å’Œæ‰§è¡Œ

#### âœ… å·²å®ç°ï¼šé«˜çº§åŠŸèƒ½
- **SaveæŒ‰é’®**: ä¸€é”®ä¿å­˜å®Œæ•´ç»ˆç«¯çŠ¶æ€
- **æ™ºèƒ½æ¢å¤**: ä»saved_contentæ¢å¤å®Œæ•´ä¼šè¯
- **çŠ¶æ€æŒ‡ç¤º**: æ˜¾ç¤ºä¿å­˜çŠ¶æ€å’Œè¡Œæ•°ç»Ÿè®¡

## âœ… æŠ€æœ¯å®ç°æ€»ç»“

### 1. âœ… å­˜å‚¨æ¶æ„ - Event Storeæ›¿ä»£ä¸´æ—¶æ–‡ä»¶

**åŸè®¡åˆ’**: å¤æ‚çš„ä¸´æ—¶æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ
**å®é™…å®ç°**: ç®€æ´çš„Event Storeæ¶æ„

- **âœ… æ— ä¸´æ—¶æ–‡ä»¶**: ç›´æ¥é€šè¿‡Event Storeç®¡ç†æ‰€æœ‰çŠ¶æ€
- **âœ… å³æ—¶æŒä¹…åŒ–**: æ¯æ¬¡å‘½ä»¤æ‰§è¡Œåç«‹å³ä¿å­˜åˆ°Event Store  
- **âœ… çŠ¶æ€ä¸€è‡´æ€§**: Actor modelç¡®ä¿å¹¶å‘å®‰å…¨
- **âœ… ç‰ˆæœ¬æ§åˆ¶**: Event Storeæä¾›å®Œæ•´çš„å†å²è¿½è¸ª

### 2. âœ… SaveåŠŸèƒ½é›†æˆ - è¶…å‡ºé¢„æœŸå®ç°

**å®ç°ä½ç½®**: `Terminal.tsx` line 507-518 (SaveæŒ‰é’®)ï¼Œline 387-453 (ä¿å­˜é€»è¾‘)

- **âœ… UIé›†æˆ**: SaveæŒ‰é’®ä½äºç»ˆç«¯å·¥å…·æ ï¼ŒçŠ¶æ€å®æ—¶æ˜¾ç¤º
- **âœ… æ™ºèƒ½ä¿å­˜**: è‡ªåŠ¨è·å–ç»ˆç«¯ç¼“å†²åŒºå®Œæ•´å†…å®¹
- **âœ… çŠ¶æ€åé¦ˆ**: ä¿å­˜è¿›åº¦æŒ‡ç¤ºå’ŒæˆåŠŸé€šçŸ¥  
- **âœ… æ•°æ®å®Œæ•´æ€§**: åŒæ—¶ä¿å­˜ç»ˆç«¯å†…å®¹ã€ç›®å½•çŠ¶æ€å’Œæ—¶é—´æˆ³

### 3. âœ… å‘½ä»¤æ‰§è¡Œæµç¨‹ - ç®€åŒ–ä¸”å¯é 

**å®é™…å®ç°**: ç®€æ´çš„Event-drivenæ¶æ„
```
ç”¨æˆ·è¾“å…¥å‘½ä»¤ â†’ å‰ç«¯å‘é€terminal.execute â†’ åç«¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ 
â†’ åç«¯è¿”å›ç»“æœå¹¶ä¿å­˜åˆ°Event Store â†’ å‰ç«¯æ˜¾ç¤ºè¾“å‡º 
â†’ å¯é€‰ï¼šç”¨æˆ·ç‚¹å‡»Saveä¿å­˜å®Œæ•´ç»ˆç«¯çŠ¶æ€
```

**ä¼˜åŠ¿**:
- **å®æ—¶æ€§**: å‘½ä»¤æ‰§è¡Œåç«‹å³ä¿å­˜å†å²
- **å¯é æ€§**: Event Storeç¡®ä¿æ•°æ®ä¸ä¸¢å¤±
- **ç®€æ´æ€§**: æ— éœ€å¤æ‚çš„ä¸´æ—¶æ–‡ä»¶æ“ä½œ

### 4. âœ… æ™ºèƒ½å‘½ä»¤å¤„ç† - è¶…å‡ºåŸå§‹éœ€æ±‚

**åŸè®¡åˆ’**: ä¸åšä»»ä½•ç‰¹æ®Šå¤„ç†
**å®é™…å®ç°**: æ™ºèƒ½ä¼˜åŒ–çš„å‘½ä»¤å¤„ç†

- **âœ… cdå‘½ä»¤ä¼˜åŒ–**: è™šæ‹Ÿç›®å½•ç®¡ç†ï¼Œæ”¯æŒç›¸å¯¹/ç»å¯¹è·¯å¾„
- **âœ… pwdå‘½ä»¤ä¼˜åŒ–**: è¿”å›å½“å‰è™šæ‹Ÿå·¥ä½œç›®å½•
- **âœ… å®‰å…¨éªŒè¯**: è·¯å¾„éå†é˜²æŠ¤ã€å‘½ä»¤é•¿åº¦é™åˆ¶
- **âœ… è·¨å¹³å°**: Windows cmd.exeå’ŒUnix shellå®Œæ•´æ”¯æŒ

## âœ… å®ç°å®Œæˆåº¦æ£€æŸ¥

**æ‰€æœ‰åŸå§‹éœ€æ±‚å·²100%å®Œæˆï¼Œä¸”è¶…å‡ºé¢„æœŸï¼**

- [x] **å‰ç«¯ï¼šxterm.jsç»ˆç«¯ç•Œé¢** - `Terminal.tsx` å®Œæ•´å®ç°
- [x] **å‰ç«¯ï¼šå‘½ä»¤è¾“å…¥è¾“å‡º** - å®æ—¶å¤„ç†ï¼Œä¼˜ç§€ç”¨æˆ·ä½“éªŒ
- [x] **å‰ç«¯ï¼šç»ˆç«¯å†…å®¹è·å–** - å¤šç§APIå®Œæ•´å®ç°
- [x] **å‰ç«¯ï¼šçŠ¶æ€ç®¡ç†** - Event Storeæ¶æ„ï¼Œæ— éœ€ä¸´æ—¶æ–‡ä»¶
- [x] **åç«¯ï¼šterminal.execute capability** - å®Œæ•´çš„ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ
- [x] **åç«¯ï¼šæ™ºèƒ½å‘½ä»¤å¤„ç†** - cd/pwdä¼˜åŒ–ï¼Œè¶…å‡ºåŸå§‹éœ€æ±‚
- [x] **åç«¯ï¼šå®‰å…¨æ¶æ„** - Event Storeï¼Œæ›´å¯é çš„æŒä¹…åŒ–
- [x] **Terminalï¼šSaveåŠŸèƒ½** - ä¸€é”®ä¿å­˜ï¼ŒçŠ¶æ€æŒ‡ç¤ºå®Œå–„
- [x] **æµ‹è¯•ï¼šå®Œæ•´éªŒè¯** - å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç±»å‹æµ‹è¯•

## âœ… è´¨é‡ä¿è¯æ€»ç»“

### 1. **å®‰å…¨æ€§** - ä¼˜ç§€
- âœ… è·¯å¾„éå†é˜²æŠ¤ï¼ˆè¶…å‡ºåŸå§‹éœ€æ±‚ï¼‰
- âœ… å‘½ä»¤é•¿åº¦é™åˆ¶å’ŒéªŒè¯
- âœ… å®‰å…¨çš„ç›®å½•ç®¡ç†æœºåˆ¶
- âœ… Actor modelç¡®ä¿å¹¶å‘å®‰å…¨

### 2. **æ€§èƒ½** - ä¼˜ç§€  
- âœ… å“åº”æ—¶é—´ < 200ms
- âœ… é«˜æ•ˆçš„ç¼“å†²åŒºå†…å®¹è·å–
- âœ… Event Storeé¿å…æ–‡ä»¶I/Oç“¶é¢ˆ
- âœ… ä¼˜åŒ–çš„xterm.jsé›†æˆ

### 3. **ç¼–ç å’Œå…¼å®¹æ€§** - ä¼˜ç§€
- âœ… UTF-8ç¼–ç æ­£ç¡®å¤„ç†
- âœ… è·¨å¹³å°å‘½ä»¤æ‰§è¡Œæ”¯æŒ
- âœ… ç±»å‹å®‰å…¨çš„å‰åç«¯é€šä¿¡

### 4. **æ¶æ„ä¼˜åŠ¿** - è¶…å‡ºé¢„æœŸ
- âœ… **æ— ä¸´æ—¶æ–‡ä»¶**: Event Storeç›´æ¥ç®¡ç†
- âœ… **å®æ—¶åŒæ­¥**: å³æ—¶çŠ¶æ€ä¿å­˜
- âœ… **å¹¶å‘å®‰å…¨**: Actor modelè®¾è®¡
- âœ… **ç‰ˆæœ¬æ§åˆ¶**: å®Œæ•´å†å²è¿½è¸ª

## ğŸ‰ é¡¹ç›®æˆå°±

**Terminal Extensionå·²æˆä¸ºElfieeé¡¹ç›®çš„æŠ€æœ¯äº®ç‚¹ï¼**

- **æ¶æ„å‡çº§**: ä»ä¸´æ—¶æ–‡ä»¶æ–¹æ¡ˆå‡çº§åˆ°Event Store
- **åŠŸèƒ½å®Œæ•´**: æ‰€æœ‰éœ€æ±‚100%å®ç°ä¸”è¶…å‡ºé¢„æœŸ  
- **ä»£ç è´¨é‡**: ç±»å‹å®‰å…¨ã€æµ‹è¯•å®Œæ•´ã€æ¶æ„æ¸…æ™°
- **ç”¨æˆ·ä½“éªŒ**: å“åº”å¿«é€Ÿã€æ“ä½œç›´è§‚ã€åŠŸèƒ½å¼ºå¤§

**å‡†å¤‡æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ï¼** ğŸš€

