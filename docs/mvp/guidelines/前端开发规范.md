# Elfiee å‰ç«¯å¼€å‘è§„èŒƒ

> æœ¬æ–‡æ¡£æ˜¯å‰ç«¯å¼€å‘çš„**å”¯ä¸€çœŸç†æ¥æº**ï¼ŒåŒ…å«æ ¸å¿ƒè§„åˆ™ã€ä»£ç æ¨¡ç‰ˆå’Œè‡ªæŸ¥æ¸…å•ã€‚

## ğŸ”´ æ ¸å¿ƒç¡¬æ€§è§„åˆ™ (Critical Rules)

1.  **NO `TauriClient` in Components**: 
    *   âŒ ä¸¥ç¦åœ¨ React ç»„ä»¶ (`.tsx`) ä¸­ç›´æ¥å¯¼å…¥æˆ–ä½¿ç”¨ `TauriClient`ã€‚
    *   âœ… ç»„ä»¶åªèƒ½è°ƒç”¨ `useAppStore` ä¸­çš„ Actionsã€‚
2.  **NO Manual Edits to `bindings.ts`**:
    *   âŒ ä¸¥ç¦æ‰‹åŠ¨ç¼–è¾‘ `src/bindings.ts`ã€‚å®ƒæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚
    *   âœ… å¦‚éœ€ä¿®æ”¹ç±»å‹ï¼Œè¯·ä¿®æ”¹ Rust ç»“æ„ä½“å¹¶æ·»åŠ  `#[derive(Type)]`ã€‚
3.  **NO Direct State Mutation**:
    *   âŒ ä¸¥ç¦ç›´æ¥ä¿®æ”¹çŠ¶æ€å¯¹è±¡ (e.g., `block.content = '...'`)ã€‚
    *   âœ… å¿…é¡»é€šè¿‡ Store Actions ä¿®æ”¹ã€‚

---

## ğŸ§© æ ‡å‡†ä»£ç æ¨¡ç‰ˆ (Code Patterns)

### 1. Zustand Action æ¨¡ç‰ˆ (åœ¨ `src/lib/app-store.ts`)

```typescript
import { create } from 'zustand';
import { TauriClient } from '@/lib/tauri-client';
import type { MyPayload } from '@/bindings'; // ä» bindings å¯¼å…¥ç±»å‹

export const useAppStore = create<AppStore>((set, get) => ({
  // å®šä¹‰çŠ¶æ€
  blocks: new Map(),

  // å®šä¹‰ Action
  myAction: async (fileId: string, param: string) => {
    try {
        // 1. æ„é€ å¼ºç±»å‹ Payload
        const payload: MyPayload = { field: param };

        // 2. è°ƒç”¨ TauriClient (ä»…å…è®¸åœ¨æ­¤å¤„è°ƒç”¨)
        await TauriClient.block.executeCommand(fileId, {
            // ... æ ‡å‡†å‘½ä»¤å­—æ®µ
            payload: payload as any
        });

        // 3. æ›´æ–°æœ¬åœ°çŠ¶æ€ (æˆåŠŸå)
        // é€šå¸¸é€šè¿‡é‡æ–°åŠ è½½å—æˆ–å®‰å…¨åœ°æ‰‹åŠ¨æ›´æ–° Map
        await get().loadAllBlocks(fileId); 
    } catch (e) {
        console.error(e);
        throw e; // è®©ç»„ä»¶å¤„ç† UI åé¦ˆ
    }
  }
}));
```

### 2. ç»„ä»¶è°ƒç”¨æ¨¡ç‰ˆ (åœ¨ `src/components/*.tsx`)

```tsx
import { useAppStore } from '@/lib/app-store';
import { toast } from '@/hooks/use-toast';

export function MyComponent({ fileId }: { fileId: string }) {
  // 1. é€‰æ‹© State å’Œ Actions
  const myAction = useAppStore(s => s.myAction);

  // 2. äº‹ä»¶å¤„ç†
  const handleClick = async () => {
    try {
      await myAction(fileId, "data");
      toast({ title: "æ“ä½œæˆåŠŸ" });
    } catch (e) {
      toast({ title: "é”™è¯¯", description: e.message, variant: "destructive" });
    }
  };

  return <button onClick={handleClick}>æ‰§è¡Œæ“ä½œ</button>;
}
```

---

## ğŸ—ï¸ æ¶æ„ä¸èµ„æºæŒ‡å—

### é™æ€èµ„æº
*   **ä½ç½®**: `src/assets/` (UIå›¾æ ‡/å›¾ç‰‡), `src-tauri/icons/` (åº”ç”¨å›¾æ ‡).
*   **å¼•å…¥**: å¿…é¡»ä½¿ç”¨ `import` (e.g. `import logo from '@/assets/logo.svg'`).
*   **ç”¨æˆ·æ•°æ®**: ä½¿ç”¨ `@tauri-apps/api/core` çš„ `convertFileSrc` å¤„ç†æœ¬åœ°è·¯å¾„.

### æ ·å¼ (Tailwind & Shadcn)
*   **ä¼˜å…ˆ**: ä½¿ç”¨ Tailwind Utility Classes (å¦‚ `flex p-4`).
*   **ç»„ä»¶**: ä¼˜å…ˆå¤ç”¨ `src/components/ui/` ä¸‹çš„ Shadcn ç»„ä»¶.
*   **æ¡ä»¶æ ·å¼**: ä½¿ç”¨ `cn()` å·¥å…·å‡½æ•° (`import { cn } from '@/lib/utils'`).

---

## ğŸ å‰ç«¯è‡ªæŸ¥æ¸…å• (Checklist)

> æäº¤ä»£ç å‰ï¼Œè¯·æ£€æŸ¥æ˜¯å¦è¿åä»¥ä¸‹æ¨¡å¼ï¼š

| æ£€æŸ¥é¡¹ | è¿è§„æ¨¡å¼ (å¦‚æœä½ å†™äº†è¿™äº›ï¼Œè¯·ä¿®æ­£) | æ­£ç¡®æ¨¡å¼ |
|:---|:---|:---|
| **æ¶æ„åˆ†å±‚** | åœ¨ `*.tsx` ä¸­å†™äº† `import { TauriClient }` | æ”¹ç”¨ `useAppStore` |
| **IPCè°ƒç”¨** | åœ¨ `*.tsx` ä¸­å†™äº† `commands.execute...` | å°è£…åˆ° Store Action ä¸­ |
| **çŠ¶æ€å˜å¼‚** | å†™äº† `state.prop = val` | ä½¿ç”¨ `set({ prop: val })` |
| **ç±»å‹å®‰å…¨** | æ‰‹åŠ¨ä¿®æ”¹äº† `src/bindings.ts` | ä¿®æ”¹ Rust ä»£ç å¹¶é‡æˆ |
| **é”™è¯¯å¤„ç†** | UI å¼‚æ­¥æ“ä½œæ²¡æœ‰ `try-catch` | åŒ…è£¹ Action è°ƒç”¨å¹¶ Toast |
